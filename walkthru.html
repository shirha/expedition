<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Walkthru</title>
  <style>
    @font-face {
      font-family: "Lora"; 
      src: url("Lora-Regular.ttf");}
    @font-face {
      font-family: "NMS Glyphs"; 
      src: url("NMS-Glyphs-Mono.ttf");}    
    body {
      background: url("screenshot.jpg") fixed no-repeat; 
      background-size: cover; font-size: 18px; margin: 20px;
    }
    pre {margin:0} /* 0 1em 0;} */
    #tt, table, pre {
      font-family: Lora;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .gy {
      display: inline-block;
      border-radius: 8px;
      padding: 0 8px;
      margin: 1px;
      font-style: normal;
      background-color: greenyellow;
    }
    .rd {
      display: inline-block;
      border-radius: 8px;
      padding: 0 8px;
      margin: 1px;
      font-style: normal;
      background-color: pink;
    }
    .gr {
      display: inline-block;
      border-radius: 8px;
      padding: 0 8px;
      margin: 1px;
      font-style: normal;
      background-color: #99ff66;;
    }
    div, table {
      display: inline-block;
      font-family: Lora;
/*      margin-left: 20px;*/
      border-collapse: collapse;
      border-spacing: 0px;
    }
    td {padding: 0;}
    img {
      height: 18px; 
      padding: 0 1px;
    }
    #tt {padding-left: 10px; /*display: none;*/}
    #mission-data-alpha {display: none;}
    #mission-data-digit {display: none;}
    span {
      white-space: nowrap;       
      border-radius: 8px;
      border: 1px solid #f0f0f0;
      padding: 0 8px;
      background: #f8f8f8;
    }
/*    .mono {font-family: monospace; text-decoration-style: double; display: inline-block;}*/
    .gl {display: inline-block; font-family: "NMS Glyphs"; font-size: larger;}

    button {
      font-size: 18px;
      background-color: #f0f0f0;
      border: 1px solid #767676;
      border-radius: 4px;
    }
    .highlight {
      background-color: #e0e0e0;
    }
    del {font-family:monospace; text-decoration-style: double;}
/*    del {font-family: monospace;}*/
    a {text-decoration: none;}
    s {color: #8080e0; text-decoration: none; /*display: none;*/}
    .units {font-family:monospace;text-decoration:line-through;text-decoration-style:double;}
    .hidden {display: none;}

    /* Style for the overlay */
    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.2);
        align-items: center;
        justify-content: flex-start;
    }
    /* Style for the image */
    .overlay img {
    /*  max-width: 80%;
        max-height: 80%; */
        border-radius: 10px;
        height: 278px;
        margin-left: 10px;
    }
    /*a {display: block;}*/
</style>
</head>
<body>
  <div class="overlay" id="imageOverlay">
      <img src="bonefish2.webp" alt="Popup Image">
  </div>
  <button onclick="handleClick(this, pre_n)">Normal</button>
  <button onclick="handleClick(this, pre_a)">A - Z</button>
  <button onclick="handleClick(this, pre_d)">1 - 5</button>
  <pre id="mission-data-digit"></pre>
  <pre id="mission-data-alpha"></pre>
  <pre id="mission-data-normal">

<a href="crafting.html" target='_blank'><b>Crafting Components List</b></a>

<div class=gy>Tip:</div> Search the yellow cargobox containers in the Space Station Teleporter rooms <img src="i/cargobox_y.webp">
<b>Sabaat Sabat // ANOMALY_001: RattleSpine-102</b>
  <div class=gy>Mine:</div> Quartzite &times;500, Sodium, Carbon, Ferrite Dust &times;100, Cobalt &times;100, Di-hydrogen &times;100
  <div class=gy>Craft:</div> Metal Plate &times;2, Ion Batteries &times;10, Life Support Gel &times;3
  <div class=gy>Refine:</div> Chromatic Metal &times;1000
  POI: Ms 1.1 Crew, Awaken
  ☐ Locate your starship
  Reward: Pre-Packaged Personal Refiner Unit; Starship Launch Fuel x 3

<b>Sabaat Sabat</b>
  <div class=gy>Buy:</div> Carbon, Rusted Metal
  POI: Ms 1.2 Wings in the Dark
  ☐ Leave the planet
  Reward: Base Computer plans; Hyperdrive plans

  POI: Ms 2.3 Starspawn
  ☐ Destroy asteroids: 0/15
  Reward: Nautilon Advanced Equipment Blueprints; Supreme Submarine Drive Upgrade; <div class=gy>Nautilon Platform</div> plans
    Magnetised Ferrite &times;90, Oxygen &times;100, &Di-hydrogen Jelly &times;1

<b>Aitoig-Bifor</b>
  POI: Ms 1.3 Between the Stars
  ☐ Warp to a new system
  Reward: Pre-Packaged Atlantid Drive Unit

<b>Unzent // Katr Gamma</b>
  POI: Ms 1.4 Timestamp 1
  ☐ Reach the 1st rendezvous
  Reward: Inventory Slot x 5; Craftable Components plans; <div class=gy>Debris Rangefinder</div> plans
    Solar Mirror &times;1, Quantum Computer &times;1, Metal Plating &times;1

  POI: Ms 1.5 Debris Field
  ☐ Acquire a Debris Rangefinder
  Reward: Corvette Basic Modules Pack

<b>Unzent</b>
  <div class=gy>Buy:</div> Carbon, Rusted Metal, Wiring Loom &times;2
  POI: Ms 1.6 Door to the Stars
  ☐ Assemble a Corvette-class starship
  Reward: Refiner Unit; Powerful Frost Protection Upgrade x 2

  POI: Ms 1.7 Shipbreaking
  ☐ Search the wreckage of a lost corvette
  Reward: Pre-Packaged Aqua-Jets Unit; <div class=gy>Advanced Mining Laser</div> plans
    Carbon Nanotubes &times;1, Hermetic Seal &times;1, Wiring Loom &times;2

<b>Unzent // Iocaeli</b>
  <div class=gy>Mine:</div> Silver &times;150, Dioxite &times;500

<b>Susono XV</b>
  <div class=gy>Buy:</div> Carbon
  POI: Ms 2.2 Lost In Time
  ☐ Relocate the time-lost wreck of the Fireship Arcadia
  Reward: Life Support Gel x 5; lon Battery x 5

<b>Susono XV // Mewor Delta</b>
  POI: Ms 2.1 Timestamp 2
  ☐ Reach the 2nd rendezvous
  Reward: Powerful Underwater Oxygen Upgrade x 2; Underwater Survival Blueprints

  POI: Ms 2.4 Operating Depth
  ☐ Deploy a Submarine
  <div class=gy>Tip:</div> You must be underwater before the build menu shows the Nautilon Platform
  Reward: Marine Shelter; Oxygen x 100; Hydrothermal Fuel Cell x 3
    <div class=gy>Pressure Membrane</div> &larr; Oxygen &times;150, Hermetic Seal &times;3, Hydrothermal Fuel Cell &times;2

  POI: Ms 2.5 Descent
  ☐ Reach ocean depths: 0/800u
  Reward: Supreme Scanning System Upgrade; Supreme Movement System Upgrade; Inventory Slot x 3

  POI: Ms 2.6 Temptation
  ☐ Collect Sea Glass: 0/3
  Reward: Supreme Mining Beam Upgrade x 2; Multi-Tool Inventory Slot x 5

  POI: Ms 2.7 Gentle Giants
  ☐ Record an underwater creature over 6kg
  Reward: Wonder Projector; Creature Pellets x 50

<b>Miyako VI</b>
  <div class=gy>Buy:</div> Carbon
  POI: Ms 3.2 The Fate of the Stars
  ☐ Relocate the time-lost wreck of the Fireship Arcadia
  Reward: Pre-Packaged Paralysis Mortar Unit; Unstable Plasma x 20; Signal Booster

<b>Miyako VI // Taures</b>
  POI: Ms 3.1 Timestamp 3 <span>+28.42, +27.80</span>
  ☐ Reach the 3rd rendezvous
  Reward: Pre-Packaged Personal Forcefield Unit; Supreme Boltcaster Upgrade

  POI: Ms 3.3 They Feed
  ☐ Kill biological horrors: 0/10
  Reward: Supreme Life Support Upgrade x 3; Inventory Slot x 5

  POI: Ms 3.6 Tendrils
  ☐ Purge 0/3 Hungering Tendrils
  Reward: Multi-Tool Inventory Slot x 3; Powerful Scatter Blaster Upgrade x 2

<b>Aikaiw</b>
  <div class=gy>Tip:</div> Consult the Galazy Map
    59 ly SW of Miyako, you may get pointed elsewhere

<b>Aikaiw // Tiusa</b>
  POI: Ms 3.4 Friends In Odd Places
  ☐ Adopt an anomalous floating companion
  Reward: Emergency Signal Scanner; Supreme Defensive Systems Upgrade; Pre-Packaged Scatter Blaster Unit; Pre-Packaged Shell Greaser Unit

<b>Miyako VI</b>
  POI: Ms 3.5 Dereliction
  ☐ Completely explore a derelict freighter
  <div class=gy>Tip:</div> You must collect the Security Credentials ... <a href="datapad.webp" target='_blank'><img src="i/photoicon2.png"></a>
    Then visit the Records Terminal, Secure Mainframe, Engineering Control
  Reward: Haz-Mat Gauntlet plans; Supreme Hyperdrive Upgrade

<b>Miyako VI // Rokkinfl IV</b>
  POI: Ms 3.7 Metamorphosis
  ☐ Crush a vile grub
  Reward: Detoxified Slime x 3; Choking Monstrosity Cake; Wriggling Tack; Haunted Pie

<b>Gerogra-Hama</b>
  POI: Ms 4.2 Frail Bodies
  ☐ Relocate the time-lost wreck of the Fireship Arcadia
  Reward: Repair Kit x 3; Supreme Thermal Protection Upgrade x 2

<b>Gerogra-Hama // Zavidi</b>
  POI: Ms 4.1 Timestamp 4 <span>+4.59, +150.71</span>
  ☐ Reach the 4th rendezvous
  Reward: Starship Inventory Slot x 5; 1,000,000 Units

  POI: Ms 4.3 Shards of the Storm
  ☐ Collect Storm Crystals: 0/5
  Reward: Oxygen x 100; Supreme Defensive Systems Upgrade

<b>Gerogra-Hama // Relliett</b>
  POI: Ms 4.5 Radiance
  ☐ Extract Radiant Shards: 0/12
  Reward: Starship Launch Fuel x 5; Supreme Pulse Engine Upgrade

  POI: Ms 4.6 Lunar Cluster
  ☐ Visit all the moons of a gas giant
  Reward: Pre-Packaged Rocket Boots Unit

  POI: Ms 4.7 No Time For Caution
  ☐ Spacewalk into a black hole
  Reward: Memory Fragment (Inventory); Defence Chit; Terrifying Sample
  <div class=gy>Tip:</div> The Black Hole may drop you in the Rendezvous 5 system!

<b>Enoher-Kadur</b>
  POI: Ms 5.2 Reborn in Song
  ☐ Relocate the time-lost wreck of the Fireship Arcadia
  Reward: Supreme Movement System Upgrade; Supreme Scanning System Upgrade

<b>Enoher-Kadur // Atter 90/Z1</b>
  POI: Ms 5.1 Timestamp 5
  ☐ Reach the final rendezvous
  Reward: Silver x 100; Gold x 100; Platinum x 100; 300 Nanites

  POI: Ms 4.4 Thermal Power
  ☐ Harvest 5 Crystal Sulphide
  Reward: Pre-Packaged Optical Drill Unit

  POI: Ms 5.3 Alien Menagerie
  ☐ Discover creatures on the final world: 0/5
  Reward: Carbon x 1000; Blob Decal plans; Curious Fauna Decal plans

  POI: Ms 5.4 Forgotten Quarries
  ☐ Gather Polished Stone: 0/192
  Reward: Fossil Display Pack

  POI: Ms 5.5 Graverobber
  ☐ Reassemble a complete skeleton
  Reward: Pre-Packaged Fishing Rig Unit; Fishing Bait recipes

  POI: Ms 5.6 Hooked
  ☐ Catch your first 3 fish
  Reward: Pre-Packaged Pulse Spitter Unit; Supreme Pulse Spitter Upgrade; Pre-Packaged Amplified Cartridges Unit

  POI: Ms 5.7 Jellyflesh
  ☐ Defeat the siren of the deep
  Reward: Blue Firework x 5; Red Firework x 5; Green Firework x 5
</pre>
<button onClick="clearLocalStorage()">Clear</button>

  <div id=tt class=hidden>Carbon,900
Cyto-Phosphate,80
Di-hydrogen,80
Ferrite Dust,800
Oxygen,180
Sodium,25</div>

  <script>
    const version = '20.2'; // Current version of the app
    const keywords = {'crystal sulphide': [], 'polished stone': []}; // when multiple Ms used, both get checked
    const conv = {
      "Hydrothermal Fuel Cell": {"Salt": 40, "Cyto-Phosphate": 40, "Carbon": 40},
      "Launch Thruster(R)": {"Ferrite Dust": 50, "Di-hydrogen": 40},
      "Pulse Engine(R)": {"Carbon": 60, "Ferrite Dust": 50},
      "Automated Trap plans": {"Salt": 50, "Ferrite Dust": 55, "Cobalt": 10},
      "Ammunition": {"Ferrite Dust": 1},
      "Carbon Nanotube": {"Carbon": 50},
      "Chromatic Metal": {"Copper": 2},
      "Condensed Carbon": {"Carbon": 2},
      "Creature Pellets": {"Carbon": 60},
      "Di-hydrogen Jelly": {"Di-hydrogen": 40},
      "Hermetic Seal": {"Carbon": 60},
      "Ion Battery": {"Cobalt": 10, "Ferrite Dust": 5},
      "Ionised Cobalt": {"Cobalt": 2},
      "Life Support Gel": {"Carbon": 20, "Di-hydrogen": 40},
      "Magnetic Resonator": {"Ferrite Dust": 80, "Cobalt": 80},
      "Magnetised Ferrite": {"Ferrite Dust": 2},
      "Pure Ferrite": {"Ferrite Dust": 1},
      "Metal Plating": {"Ferrite Dust": 50},
      "Microprocessor": {"Carbon": 50, "Copper": 80},
      "Sodium Nitrate": {"Sodium": 2},
      "Warp Cell": {"Oxygen": 30, "Ferrite Dust": 50, "Copper": 50, "Carbon": 40},
      "Titan Base": {"Ferrite Dust": 40, "Copper": 60, "Carbon": 280},
    };
    let tt, obj, dict = {}, title, pre_n, pre_a, pre_d, poi = [];

    function handleClick(button, param) {
      // Remove highlight from the previously clicked button
      if (lastClickedButton) {
        lastClickedButton.classList.remove('highlight');
      }

      // Add highlight to the currently clicked button
      button.classList.add('highlight');

      // Update the reference to the last clicked button
      lastClickedButton = button;

      // Call the show function with the provided parameter
      show(param);
    }

    function show(e) {
      pre_n.style.display =
      pre_a.style.display =
      pre_d.style.display = "none"; 
      e.style.display     = "block";

      // Restore checkbox states from localStorage
      const sel = `#${e.id} input[type="checkbox"]`;
      console.log(sel);
      document.querySelectorAll(sel).forEach(checkbox => {
        const id = checkbox.id;
        const savedState = localStorage.getItem(id);
        if (savedState !== null) {
          checkbox.checked = savedState === "true";
        }
      });
    }

    let lastClickedButton = null;

    function clearLocalStorage() {
      if(confirm("Are you sure?")){
        localStorage.clear();
        location.reload(); 
      }
    }

    function manageVersioning() {
      const storedVersion = localStorage.getItem('checkbox-0');
      if (storedVersion !== version) {
        // Clear localStorage if versions are different
        localStorage.clear();
        localStorage.setItem('checkbox-0', version); // Store the new version
      }
    }

    function parsePreContent() {
      pre_n = document.getElementById('mission-data-normal');
      pre_a = document.getElementById('mission-data-alpha');
      pre_d = document.getElementById('mission-data-digit');
      const content = pre_n.innerHTML; // textContent;
      const lines = content.split('\n');
      let checkboxCount = 0, id, trace;
      const parsedContent = lines.map(line => {
        let match = line.match(/POI: Ms (\d\.\d) (.+)/);
        if (match) {
          poi.push([match[1], match[2], line]);
        }
        if (line.includes('☐')) {
          checkboxCount++;
          id = `checkbox-${checkboxCount}`;
          dict[id] = {};

          // track keywords in an Object (see Omega Redux)
          Object.keys(keywords).forEach(key => {
            if(line.toLowerCase().includes(key)){
              keywords[key].push(id);
            }
          });

          // Replace ☐ with an input checkbox element
          line = line.replace('☐', `<input type="checkbox" id="${id}">`)
          if(poi[poi.length-1].length == 3)
            poi[poi.length-1] = [...poi[poi.length-1], line];
          return line;
        }
        if (line.startsWith('\`')) {
          return line.slice(1);
        }

        match = line.match(/(\w[\w\s\(\)-]+) ×(\d+)/);
        if (match) {
          const key = match[1]; // Object.keys(dict).find(k => line.includes(k));
          const value = parseInt(match[2], 10);
          if (id) {
            const dbg = id.match(/checkbox/);
            const temp = '' //{3:"Advanced Mining Beam",4:"Personal Refiner MK2",5:"Repair Starship & Multi-tool",7:"Leave planet",13:"Restore crashed ship",9:"Hyperdrive",16:"Nutrient Processor, Haz-Mat Gauntlet",19:"Shell Greaser",22:"Mind Arc",23:"Cadmium Drive",29:"Nautilon Chamber, High-Power Sonar"}[checkboxCount];
            if (title != temp) {title = temp; console.log(title);}
            if (key in conv){
              Object.keys(conv[key]).map(k => {
                if (k in dict[id]) { trace = 'conv-1';
                  dict[id][k] += conv[key][k] * value;
                  if (dbg) 
                    console.log(`${id}, ${key.padEnd(18)}, ${String(value).padStart(3)}, ${k.padEnd(18)}, ${dict[id][k]}`);
                } else { trace = 'conv-0';
                  dict[id][k] = conv[key][k] * value;
                  if (dbg) 
                    console.log(`${id}, ${key.padEnd(18)}, ${String(value).padStart(3)}, ${k.padEnd(18)}, ${dict[id][k]}`);
                }
              });
            } else {
              if (key in dict[id]) { trace = 'dict-1';
                dict[id][key] += value; k = '';
                if (dbg) 
                  console.log(`${id}, ${key.padEnd(18)}, ${String(value).padStart(3)}, ${k.padEnd(18)}, ${dict[id][key]}`);
              } else { trace = 'dict-0';
                dict[id][key] = value; k = '';
                if (dbg) 
                  console.log(`${id}, ${key.padEnd(18)}, ${String(value).padStart(3)}, ${k.padEnd(18)}, ${dict[id][key]}`);
              }
            }
          }
        }
        return line; // Return the line unmodified if no checkbox found
      }).join('\n');

      // console.log(JSON.stringify(poi, null, 2)); 
      pre_d.innerHTML = poi.sort((a,b)=>a[0].localeCompare(b[0])).map(a=>`${a[2]}\n${a[3]}\n`).join('');
      pre_a.innerHTML = poi.sort((a,b)=>a[1].localeCompare(b[1])).map(a=>`${a[2]}\n${a[3]}\n`).join('');

      pre_n.innerHTML = parsedContent;
      console.log('');
      // console.log(parsedContent);

      // Restore checkbox states from localStorage
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        const id = checkbox.id;
        const savedState = localStorage.getItem(id);
        if (savedState !== null) {
          checkbox.checked = savedState === "true";

          const parentId = checkbox.parentNode.id;
          console.log(`${parentId}, ${id}`);
          let flag = false;
          Object.keys(dict[id]).forEach(key =>{
            if (key in obj && checkbox.checked && parentId == 'mission-data-normal') {
              flag = true;
              obj[key] += dict[id][key] * (checkbox.checked ? -1 : 1);
              console.log(`${parentId}, ${id}, ${key.padEnd(18)}, ${String(dict[id][key]).padStart(3)}, ${obj[key]}`);
            }
          });
          if (flag) {
            document.getElementById('tt').textContent = Object.keys(obj).map(k => `${k},${obj[k]}`).join('\n');
          }
        }

        checkbox.addEventListener('change', () => {
          localStorage.setItem(id, checkbox.checked);

          const parentId = checkbox.parentNode.id;
          let flag = false;
          Object.keys(dict[id]).forEach(key =>{
            if (key in obj && parentId == 'mission-data-normal') {
              flag = true;
              obj[key] += dict[id][key] * (checkbox.checked ? -1 : 1);
            }
          });
          if (flag) {
            document.getElementById('tt').textContent = Object.keys(obj).map(k => `${k},${obj[k]}`).join('\n');
          }

          // Loop through each keyword group
          Object.keys(keywords).forEach(key => {
            if (keywords[key].includes(id)) {
              // If this checkbox belongs to a keyword group, toggle all related checkboxes
              keywords[key].forEach(relatedId => {
                const relatedCheckbox = document.querySelectorAll(`#${relatedId}`);
                console.log(id,relatedCheckbox);
                relatedCheckbox.forEach(relatedCheckboxTab => {
                  if (relatedCheckboxTab) {
                    relatedCheckboxTab.checked = checkbox.checked;
                    localStorage.setItem(relatedId, checkbox.checked); // Update localStorage for related checkboxes
                  }
                });
              });
            }
          });

        });
      });
    }

    function parseComponents() {
      return tt.textContent.split('\n') // Split the string into lines
        .map(line => line.trim()) // Trim leading/trailing spaces
        .map(line => line.split(',')) // Split each line into key-value pairs
        .reduce((acc, [key, value]) => {
          acc[key] = parseInt(value, 10); // Add to object, parse value as an integer
          return acc;
        }, {});
    }

    function updateComponents(checkbox, id) {
      let flag = false;
      Object.keys(dict[id]).forEach(key =>{
        if (key in obj && checkbox.checked) {
          flag = true;
          obj[key] += dict[id][key] * (checkbox.checked ? -1 : 1);
          // console.log(key, obj[key]);
        }
      });
      if (flag) {
        document.getElementById('tt').textContent = Object.keys(obj).map(k => `${k},${obj[k]}`).join('\n');
        console.log(tt);
      }
    }

    function openImage() {
        // event.preventDefault();
        console.log("Show the overlay when clicking the link");
        document.getElementById("imageOverlay").style.display = "flex";
    }

    // On DOMContentLoaded, check version and parse content
    document.addEventListener('DOMContentLoaded', () => {
      tt    = document.querySelector('#tt');
      obj   = parseComponents();
      pre_n = document.getElementById('mission-data-normal');
      pre_a = document.getElementById('mission-data-alpha');
      pre_d = document.getElementById('mission-data-digit');
      manageVersioning();
      parsePreContent();

      const overlay = document.getElementById("imageOverlay");
      const openImage = document.getElementById("openImage");

      // Show the overlay when clicking the link
      // openImage.addEventListener("click", function(event) {
      //     event.preventDefault();
      //     console.log("Show the overlay when clicking the link");
      //     overlay.style.display = "flex";
      // });

      // Close the overlay when clicking anywhere
      overlay.addEventListener("click", function() {
          console.log("Close the overlay when clicking anywhere");
          overlay.style.display = "none";
      });

      // console.log(overlay,openImage);

// document.querySelectorAll('input[type="checkbox"').forEach(checkbox => {checkbox.checked = true; localStorage.setItem(checkbox.id, checkbox.checked);});
    });
  </script>
</body>
</html>
