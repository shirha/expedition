<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Walkthru</title>
  <style>
    @font-face {
      font-family: "Lora"; 
      src: url("Lora-Regular.ttf");}
    @font-face {
      font-family: "NMS Glyphs"; 
      src: url("NMS-Glyphs-Mono.ttf");}    
    body {
      background: url("screenshot.jpg") fixed no-repeat; 
      background-size: cover; font-size: 18px; margin: 20px;
    }
    pre {margin:0 0 1em 0;}
    #tt, table, pre {
      font-family: Lora;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .gy {
      display: inline-block;
      border-radius: 8px;
      padding: 0 8px;
      margin: 1px;
      font-style: normal;
      background-color: greenyellow;
    }
    .rd {
      display: inline-block;
      border-radius: 8px;
      padding: 0 8px;
      margin: 1px;
      font-style: normal;
      background-color: pink;
    }
    .gr {
      display: inline-block;
      border-radius: 8px;
      padding: 0 8px;
      margin: 1px;
      font-style: normal;
      background-color: #99ff66;;
    }
    div, table {
      display: inline-block;
      font-family: Lora;
/*      margin-left: 20px;*/
      border-collapse: collapse;
      border-spacing: 0px;
    }
    td {padding: 0;}
    img {
      height: 18px; 
      padding: 0 1px;
    }
    #tt {padding-left: 10px; /*display: none;*/}
    #mission-data-alpha {display: none;}
    #mission-data-digit {display: none;}
    span {
      white-space: nowrap;       
      border-radius: 8px;
      border: 1px solid #f0f0f0;
      padding: 0 8px;
      background: #f8f8f8;
    }
/*    .mono {font-family: monospace; text-decoration-style: double; display: inline-block;}*/
    .gl {display: inline-block; font-family: "NMS Glyphs"; font-size: larger;}

    button {
      font-size: 18px;
      background-color: #f0f0f0;
      border: 1px solid #767676;
      border-radius: 4px;
    }
    .highlight {
      background-color: #e0e0e0;
    }
    del {font-family:monospace; text-decoration-style: double;}
/*    del {font-family: monospace;}*/
    a {text-decoration: none;}
    s {color: #8080e0; text-decoration: none; /*display: none;*/}
    .units {font-family:monospace;text-decoration:line-through;text-decoration-style:double;}
    .hidden {display: none;}

    /* Style for the overlay */
    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.2);
        align-items: center;
        justify-content: flex-start;
    }
    /* Style for the image */
    .overlay img {
    /*  max-width: 80%;
        max-height: 80%; */
        border-radius: 10px;
        height: 278px;
        margin-left: 10px;
    }
</style>
</head>
<body>
  <div class="overlay" id="imageOverlay">
      <img src="bonefish2.webp" alt="Popup Image">
  </div>
  <button onclick="handleClick(this, pre_n)">Normal</button>
  <button onclick="handleClick(this, pre_a)">A - Z</button>
  <button onclick="handleClick(this, pre_d)">1 - 5</button>
  <a style="display:block;padding:.5em 0;" target="_blank" 
    href="https://www.youtube.com/watch?v=rh4OOtM8y2c">How To Finish The Corvette Expedition Fast | Jason Plays</a>
  <pre id="mission-data-digit"></pre>
  <pre id="mission-data-alpha"></pre>
  <pre id="mission-data-normal"><b>Killur VII // New Nayli</b>
  POI: Ms 1.1 Link to the Stars
  ☐ Rise from the wreckage of your ship
  <div class=gy>Tip:</div> Grab &times;20 Gravitino Balls, Oxygen, Carbon
        Exit ship to get 'Orbital Uplink' blueprint
        Dismantle Boltcaster (Chromatic Metal), Rocket Launcher (Cooper)
  Reward: Corvette Basic Modules Pack

<b>Killur VII</b>
  POI: Ms 1.2 Ship Architecture
  <div class=gy>Tip:</div> Buy &times;3 Microprocessors, &times;1 Metal Plating, &times;2 Wiring Loom, Fe, Co
  ☐ Assemble your first Corvette
  Reward: Pre-Packaged Scatter Blaster Unit; Pre-Packaged Shell Greaser Unit; Supreme Scatter Blaster Upgrade; Projectile Ammunition x 2500

<b>Killur VII // Uehildf Maiba</b>
  POI: Ms 1.4 Cruising
  ☐ Engage Corvette autopilot for 30s
  Reward: Pre-Packaged Cyclotron Ballista Unit; Pre-Packaged Dyson Pump Unit; Supreme Starship Weapon Upgrade

  POI: Ms 1.3 Salvaging
  ☐ Excavate 5 Corvette Modules
  Reward: Corvette Window Modules Pack  <!--div class=gy>Tip:</div> Store modules in Corvette Workshop Cache (Tab) -->

<b>OwO III Squeakule</b>
  POI: Ms 1.5 Can't Take the Sky
  ☐ Warp to a new system
  Reward: Inventory Slot x 10; Life Support Gel x 10; Banned Hyperdrive Upgrade

  POI: Ms 3.3 Heavyweight
  ☐ Destroy asteroids: 0/40
  Reward: Corvette Wing Modules Pack; Starship Inventory Slot x 2

  POI: Ms 1.6 Anarchy
  ☐ Defeat Sentinel Interceptors: 0/3
  Reward: Microprocessor x 10; Hermetic Seal x 10; Hydraulic Wiring x 10; Amino Chamber x 10; lon Battery x 10

<b>OwO III Squeakule // Rawr Gamma</b>
  POI: Ms 3.4 Wild Things
  ☐ Discover 3 creatures on dissonant worlds
  <div class=gy>Reward:</div> Echo Locator; Banned Defensive Systems Upgrade; Inventory Slot x 5

  POI: Ms 3.5 Reclaimed Weaponry
  ☐ Claim a Multi-Tool from a Harmonic Camp
  Reward: Multi-Tool Inventory Slot x 5; Banned Boltcaster Upgrade; Supreme Boltcaster Upgrade x 2

  POI: Ms 3.6 Undying Horde
  ☐ Eliminate Corrupt Sentinels: 0/8
  Reward: 1,000,000 Units; 500 Nanites

<b>OwO III Squeakule</b>
  <div class=gy>Tip:</div> Sell Boltcaster upgrades
        Buy A,B Hyperdrive upgrades

<b>Ganariysh</b>
  POI: Ms 1.7 Resist: I
  ☐ Sign the first rendezvous station
  Reward: Corvette Hull Modules Pack

<b>Balsan-Rehol</b>
  POI: Ms 2.1 Resist: II
  ☐ Sign the second rendezvous station
  Reward: Corvette Habitation Modules Pack

  POI: Ms 2.2 Advance: Expand
  ☐ Install Corvette inventory modules
  <div class=gy>Reward:</div> Collection of plantable seeds; Pre-Packaged Haz-Mat Gauntlet Unit

<b>Balsan-Rehol // Zakra</b>
  <div class=gy>Tip:</div> Harvest &times;400 Frostwort, &times;200 Dioxite

  POI: Ms 2.3 Silent Running
  ☐ Harvest plants on your Corvette: 0/8
  Reward: Supreme Frost Protection Upgrade; Banned Defensive Systems Upgrade

  POI: Ms 2.4 Extravehicular
  ☐ Drift among the stars for 60s
  Reward: Banned Movement System Upgrade; Pre-Packaged Cloaking Device Unit; Banned Scanning System Upgrade

  POI: Ms 5.6 Aperture
  ☐ Take a photo of your Corvette
  Reward: Living Pearl x 5; Albumen Pearl x 5; Gravitino Ball x 5

<b>Balsan-Rehol // Gabridge Nohe</b>
  POI: Ms 2.5 Grounded
  ☐ Visit a lush world
  <div class=gy>Reward:</div> Pre-Packaged Fishing Rig Unit; Fishing Bait recipes

  POI: Ms 4.5 Stardiving
  ☐ Fall for 60s from a Corvette
  <div class=gy>Tip:</div> Select the milestone and just fly in a storm
  Reward: Rocket Boots plans; Collection of Decals

  POI: Ms 2.6 Proteins from the Sea
  ☐ Catch your first 3 fish
  Reward: Pre-Packaged Blaze Javelin Unit; Pre-Packaged Mass Accelerator Unit; Supreme Blaze Javelin Upgrade

  POI: Ms 2.7 Fresh Rations
  ☐ Prepare seafood in a Corvette Nutrition Unit
  Reward: Corvette Hull Modules Pack

<b>Tumenni-Zes</b>
  POI: Ms 3.1 Resist: III
  ☐ Sign the third rendezvous station
  <div class=gy>Reward:</div> Corvette Engine Modules Pack; Starship Inventory Slot x 2

  POI: Ms 3.2 Advance: Move
  ☐ Install Corvette manoeuvrability modules
  Reward: Corvette Decoration Modules Pack; Starship Inventory Slot x 2

  POI: Ms 3.7 Flightpath
  ☐ Pilot your Corvette: 100,000/100,000u
  Reward: Corvette Hull Modules Pack

<b>Ushuna-Redit</b>
  POI: Ms 4.1 Resist: IV
  ☐ Sign the fourth rendezvous station
  <div class=gy>Reward:</div> Corvette Shielding Modules Pack; Starship Inventory Slot x 3

  POI: Ms 4.2 Advance: Defend
  ☐ Install Corvette shield modules
  <div class=gy>Reward:</div> Corvette Weapon Modules Pack; Starship Inventory Slot x 2

  POI: Ms 4.3 Advance: Destroy
  ☐ Install Corvette damage modules
  <div class=gy>Reward:</div> Walker Brain; Starship Inventory Slot x 1; Conflict Scanner plans

  POI: Ms 4.4 Hitchhiking [Optional]
  ☐ Embark upon another Traveller's Corvette
  Reward: Assortment of cakes; 500 Quicksilver

<b>Akyotsu <img src="i/skull_icon2.png"></b>
  POI: Ms 4.6 Off the Radar
  ☐ Visit a pirate system
  <div class=gy>Tip:</div> Install Conflict Scanner
          Walker Brain ×1, Wiring Loom ×1
        Use Galaxy Map and look for red conflict level w/pirate symbol
  <div class=gy>Reward:</div> Emergency Warp Unit plans; Starship Inventory Slot x 1

<b>Okyotang V</b>
  POI: Ms 4.7 Under Their Noses
  ☐ Smuggle contraband: 0 units/160,000 units
  Reward: Unearthed Treasure x 3; Aquatic Treasure x 3; Inventory Slot x 5

  POI: Ms 5.1 Resist: V
  ☐ Sign the fifth rendezvous station
  <div class=gy>Reward:</div> Corvette Reactor Modules Pack

  POI: Ms 5.2 Advance: Heart
  ☐ Install an additional reactor
  <div class=gy>Reward:</div> Anomaly Detector

  POI: Ms 5.3 Dwarfed
  ☐ Find deep-space anomalies: 0/1
  <div class=gy>Reward:</div> Emergency Signal Scanner; Inventory Slot x 3

  POI: Ms 5.4 Spacewreck
  ☐ Completely explore a derelict freighter
  <div class=gy>Reward:</div> Repair Kit x 3; Sentinel Boundary Map, Personal Forcefield plans

  POI: Ms 5.5 One, Zero
  ☐ Shut down a planet's Sentinel forces
  Reward: Wheel of Hirk Firework x 25

  POI: Ms 4.8 Fast Scramble
  ☐ Engage the Emergency Warp Unit
  Reward: Corvette Hull Modules Pack

  POI: Ms 5.7 Resistance [Optional]
  ☐ Restore Sentinel / Traveller neutrality
  Reward: 1,200 Quicksilver
</pre>
  <button onClick="clearLocalStorage()">Clear</button>

  <div id=tt class=hidden>Carbon,900
Cyto-Phosphate,80
Di-hydrogen,80
Ferrite Dust,800
Oxygen,180
Sodium,25</div>

  <script>
    const version = '18.1'; // Current version of the app
    const keywords = {'bonefish': [], 'exotic': []}; // when multiple Ms used, both get checked
    const conv = {
      "Hydrothermal Fuel Cell": {"Salt": 40, "Cyto-Phosphate": 40, "Carbon": 40},
      "Launch Thruster(R)": {"Ferrite Dust": 50, "Di-hydrogen": 40},
      "Pulse Engine(R)": {"Carbon": 60, "Ferrite Dust": 50},
      "Automated Trap plans": {"Salt": 50, "Ferrite Dust": 55, "Cobalt": 10},
      "Ammunition": {"Ferrite Dust": 1},
      "Carbon Nanotube": {"Carbon": 50},
      "Chromatic Metal": {"Copper": 2},
      "Condensed Carbon": {"Carbon": 2},
      "Creature Pellets": {"Carbon": 60},
      "Di-hydrogen Jelly": {"Di-hydrogen": 40},
      "Hermetic Seal": {"Carbon": 60},
      "Ion Battery": {"Cobalt": 10, "Ferrite Dust": 5},
      "Ionised Cobalt": {"Cobalt": 2},
      "Life Support Gel": {"Carbon": 20, "Di-hydrogen": 40},
      "Magnetic Resonator": {"Ferrite Dust": 80, "Cobalt": 80},
      "Magnetised Ferrite": {"Ferrite Dust": 2},
      "Pure Ferrite": {"Ferrite Dust": 1},
      "Metal Plating": {"Ferrite Dust": 50},
      "Microprocessor": {"Carbon": 50, "Copper": 80},
      "Sodium Nitrate": {"Sodium": 2},
      "Warp Cell": {"Oxygen": 30, "Ferrite Dust": 50, "Copper": 50, "Carbon": 40},
      "Titan Base": {"Ferrite Dust": 40, "Copper": 60, "Carbon": 280},
    };
    let tt, obj, dict = {}, title, pre_n, pre_a, pre_d, poi = [];

    function handleClick(button, param) {
      // Remove highlight from the previously clicked button
      if (lastClickedButton) {
        lastClickedButton.classList.remove('highlight');
      }

      // Add highlight to the currently clicked button
      button.classList.add('highlight');

      // Update the reference to the last clicked button
      lastClickedButton = button;

      // Call the show function with the provided parameter
      show(param);
    }

    function show(e) {
      pre_n.style.display =
      pre_a.style.display =
      pre_d.style.display = "none"; 
      e.style.display     = "block";

      // Restore checkbox states from localStorage
      const sel = `#${e.id} input[type="checkbox"]`;
      console.log(sel);
      document.querySelectorAll(sel).forEach(checkbox => {
        const id = checkbox.id;
        const savedState = localStorage.getItem(id);
        if (savedState !== null) {
          checkbox.checked = savedState === "true";
        }
      });
    }

    let lastClickedButton = null;

    function clearLocalStorage() {
      if(confirm("Are you sure?")){
        localStorage.clear();
        location.reload(); 
      }
    }

    function manageVersioning() {
      const storedVersion = localStorage.getItem('checkbox-0');
      if (storedVersion !== version) {
        // Clear localStorage if versions are different
        localStorage.clear();
        localStorage.setItem('checkbox-0', version); // Store the new version
      }
    }

    function parsePreContent() {
      pre_n = document.getElementById('mission-data-normal');
      pre_a = document.getElementById('mission-data-alpha');
      pre_d = document.getElementById('mission-data-digit');
      const content = pre_n.innerHTML; // textContent;
      const lines = content.split('\n');
      let checkboxCount = 0, id, trace;
      const parsedContent = lines.map(line => {
        let match = line.match(/POI: Ms (\d\.\d) (.+)/);
        if (match) {
          poi.push([match[1], match[2], line]);
        }
        if (line.includes('☐')) {
          checkboxCount++;
          id = `checkbox-${checkboxCount}`;
          dict[id] = {};

          // track keywords in an Object (see Omega Redux)
          Object.keys(keywords).forEach(key => {
            if(line.toLowerCase().includes(key)){
              keywords[key].push(id);
            }
          });

          // Replace ☐ with an input checkbox element
          line = line.replace('☐', `<input type="checkbox" id="${id}">`)
          if(poi[poi.length-1].length == 3)
            poi[poi.length-1] = [...poi[poi.length-1], line];
          return line;
        }
        if (line.startsWith('\`')) {
          return line.slice(1);
        }

        match = line.match(/(\w[\w\s\(\)-]+) ×(\d+)/);
        if (match) {
          const key = match[1]; // Object.keys(dict).find(k => line.includes(k));
          const value = parseInt(match[2], 10);
          if (id) {
            const dbg = id.match(/checkbox/);
            const temp = '' //{3:"Advanced Mining Beam",4:"Personal Refiner MK2",5:"Repair Starship & Multi-tool",7:"Leave planet",13:"Restore crashed ship",9:"Hyperdrive",16:"Nutrient Processor, Haz-Mat Gauntlet",19:"Shell Greaser",22:"Mind Arc",23:"Cadmium Drive",29:"Nautilon Chamber, High-Power Sonar"}[checkboxCount];
            if (title != temp) {title = temp; console.log(title);}
            if (key in conv){
              Object.keys(conv[key]).map(k => {
                if (k in dict[id]) { trace = 'conv-1';
                  dict[id][k] += conv[key][k] * value;
                  if (dbg) 
                    console.log(`${id}, ${key.padEnd(18)}, ${String(value).padStart(3)}, ${k.padEnd(18)}, ${dict[id][k]}`);
                } else { trace = 'conv-0';
                  dict[id][k] = conv[key][k] * value;
                  if (dbg) 
                    console.log(`${id}, ${key.padEnd(18)}, ${String(value).padStart(3)}, ${k.padEnd(18)}, ${dict[id][k]}`);
                }
              });
            } else {
              if (key in dict[id]) { trace = 'dict-1';
                dict[id][key] += value; k = '';
                if (dbg) 
                  console.log(`${id}, ${key.padEnd(18)}, ${String(value).padStart(3)}, ${k.padEnd(18)}, ${dict[id][key]}`);
              } else { trace = 'dict-0';
                dict[id][key] = value; k = '';
                if (dbg) 
                  console.log(`${id}, ${key.padEnd(18)}, ${String(value).padStart(3)}, ${k.padEnd(18)}, ${dict[id][key]}`);
              }
            }
          }
        }
        return line; // Return the line unmodified if no checkbox found
      }).join('\n');

      // console.log(JSON.stringify(poi, null, 2)); 
      pre_d.innerHTML = poi.sort((a,b)=>a[0].localeCompare(b[0])).map(a=>`${a[2]}\n${a[3]}\n`).join('');
      pre_a.innerHTML = poi.sort((a,b)=>a[1].localeCompare(b[1])).map(a=>`${a[2]}\n${a[3]}\n`).join('');

      pre_n.innerHTML = parsedContent;
      console.log('');
      // console.log(parsedContent);

      // Restore checkbox states from localStorage
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        const id = checkbox.id;
        const savedState = localStorage.getItem(id);
        if (savedState !== null) {
          checkbox.checked = savedState === "true";

          const parentId = checkbox.parentNode.id;
          console.log(`${parentId}, ${id}`);
          let flag = false;
          Object.keys(dict[id]).forEach(key =>{
            if (key in obj && checkbox.checked && parentId == 'mission-data-normal') {
              flag = true;
              obj[key] += dict[id][key] * (checkbox.checked ? -1 : 1);
              console.log(`${parentId}, ${id}, ${key.padEnd(18)}, ${String(dict[id][key]).padStart(3)}, ${obj[key]}`);
            }
          });
          if (flag) {
            document.getElementById('tt').textContent = Object.keys(obj).map(k => `${k},${obj[k]}`).join('\n');
          }
        }

        checkbox.addEventListener('change', () => {
          localStorage.setItem(id, checkbox.checked);

          const parentId = checkbox.parentNode.id;
          let flag = false;
          Object.keys(dict[id]).forEach(key =>{
            if (key in obj && parentId == 'mission-data-normal') {
              flag = true;
              obj[key] += dict[id][key] * (checkbox.checked ? -1 : 1);
            }
          });
          if (flag) {
            document.getElementById('tt').textContent = Object.keys(obj).map(k => `${k},${obj[k]}`).join('\n');
          }

          // Loop through each keyword group
          Object.keys(keywords).forEach(key => {
            if (keywords[key].includes(id)) {
              // If this checkbox belongs to a keyword group, toggle all related checkboxes
              keywords[key].forEach(relatedId => {
                const relatedCheckbox = document.querySelectorAll(`#${relatedId}`);
                console.log(id,relatedCheckbox);
                relatedCheckbox.forEach(relatedCheckboxTab => {
                  if (relatedCheckboxTab) {
                    relatedCheckboxTab.checked = checkbox.checked;
                    localStorage.setItem(relatedId, checkbox.checked); // Update localStorage for related checkboxes
                  }
                });
              });
            }
          });

        });
      });
    }

    function parseComponents() {
      return tt.textContent.split('\n') // Split the string into lines
        .map(line => line.trim()) // Trim leading/trailing spaces
        .map(line => line.split(',')) // Split each line into key-value pairs
        .reduce((acc, [key, value]) => {
          acc[key] = parseInt(value, 10); // Add to object, parse value as an integer
          return acc;
        }, {});
    }

    function updateComponents(checkbox, id) {
      let flag = false;
      Object.keys(dict[id]).forEach(key =>{
        if (key in obj && checkbox.checked) {
          flag = true;
          obj[key] += dict[id][key] * (checkbox.checked ? -1 : 1);
          // console.log(key, obj[key]);
        }
      });
      if (flag) {
        document.getElementById('tt').textContent = Object.keys(obj).map(k => `${k},${obj[k]}`).join('\n');
        console.log(tt);
      }
    }

    function openImage() {
        // event.preventDefault();
        console.log("Show the overlay when clicking the link");
        document.getElementById("imageOverlay").style.display = "flex";
    }

    // On DOMContentLoaded, check version and parse content
    document.addEventListener('DOMContentLoaded', () => {
      tt    = document.querySelector('#tt');
      obj   = parseComponents();
      pre_n = document.getElementById('mission-data-normal');
      pre_a = document.getElementById('mission-data-alpha');
      pre_d = document.getElementById('mission-data-digit');
      manageVersioning();
      parsePreContent();

      const overlay = document.getElementById("imageOverlay");
      const openImage = document.getElementById("openImage");

      // Show the overlay when clicking the link
      // openImage.addEventListener("click", function(event) {
      //     event.preventDefault();
      //     console.log("Show the overlay when clicking the link");
      //     overlay.style.display = "flex";
      // });

      // Close the overlay when clicking anywhere
      overlay.addEventListener("click", function() {
          console.log("Close the overlay when clicking anywhere");
          overlay.style.display = "none";
      });

      // console.log(overlay,openImage);

// document.querySelectorAll('input[type="checkbox"').forEach(checkbox => {checkbox.checked = true; localStorage.setItem(checkbox.id, checkbox.checked);});
    });
  </script>
</body>
</html>

  <!-- href="javascript:openImage()"
<b>Yugaiati // Haisypoh</b>
  ☐ Catch a Whispering or Bleached <a href="javascript:void(0);" id=openImage>Bonefish <img src="i/linkicon1.png"></a>
   div class=gy>Important:</div> Fly back to dig site before reassembling
  <div class=gy>Important:</div> Fly back to dig site before reassembling
  <div class=gy>Important:</div> Fly back to dig site before reassembling
  <div class=gy>Important:</div> Fly back to dig site before reassembling
  <a target='_blank' href="https://nomanssky.fandom.com/wiki/Biome_-_Toxic#Name_generation">Wiki <img src="i/linkicon1.png"></a-->
